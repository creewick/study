[study](../) > [inet](./) > routing

# Маршрутизация

Routing - процесс определения маршрута следования информации в сетях связи.

[TOC]

# Способы адресации

## Classful Network

Адресное пространство протокола IPv4 делится на пять классов адресов: А, B, C, D, E.

Принадлежность адреса к классу задаётся первыми битами адреса. Каждый класс определяет либо соответствующий размер сети (классы A, B, C), либо сеть многоадресной передачи (класс D). Диапазон адресов класса E был зарезервирован для будущих или экспериментальных целей.

Использование адрессации на базе классов сейчас прекращено.

**Класс A:** `0aaaaaaa bbbbbbbb bbbbbbbb bbbbbbbb`

- Адрес сети: 7 бит
- Адрес хоста: 24 бита

**Класс B:** `10aaaaaa aaaaaaaa bbbbbbbb bbbbbbbb`

- Адрес сети: 14 бит
- Адрес хоста: 16 бит

**Класс C:** `110aaaaa aaaaaaaa aaaaaaaa bbbbbbbb`

- Адрес сети: 21 бит
- Адрес хоста: 8 бит

**Класс D:** `1110сссс сссссссс сссссссс сссссссс`

- Адрес многоадресной рассылки: 28 бит

**Класс E:** `1111dddd dddddddd dddddddd dddddddd`

## Classless Inter-Domain Routing

Каждому поставщику услуг Интернета назначается непрерывный диапазон IP-адресов.

Все адреса каждого поставщика услуг имеют общую старшую часть - префикс, поэтому маршрутизация на магистралях Интернета может осуществляться на основе префиксов, а не полных адресов сетей.

Достаточно поместить одну запись сразу для всех сетей, имеющих общий префикс.

**IP:**		 `172.16.0.1`

`10101100 00010000 00000000 00000001`

**Маска:**	 `255.240.0.0`

`11111111 11110000 00000000 00000000`

*Сокращенно:* `172.16.0.1/12`

# Протоколы маршрутизации

- Не требующие таблиц маршрутизации

  *Лавинная, от источника*

- Требующие таблиц маршрутизации

  - Статические

    *Админ сам заполняет таблицы*

  - Адаптивные

    - Дистанционно-векторные
    - Состояния связей

## RIP

Routing Information Protocol - протокол динамической маршрутизации, относящийся к дистанционно-векторным протоколам. 

Очень простой. Применяется в небольших сетях. В качестве метрики использует число переходов.

Максимальное число хопов: 15

Работает на сетевом уровне, 520/UDP

### Формат пакета RIP v1

`Команда` `Версия ` `0000000000000000`

`-Тип-адреса(2)` ` 0000000000000000`

`-------Адрес-IPv4(4-байта)------`

`00000000000000000000000000000000`

`00000000000000000000000000000000`

`--------Метрика(4-байта)--------`

Команды:

1. request
2. response

## OSPF

Open Shortest Path First - протокол динамической маршрутизации, основанный на технологии отслеживании состояния канала.

Протокол внутридоменной маршрутизации.

Используется метрика стоимости, вычисляемая на основе полосы пропускания каналов. 

### Возможности OSPF

* Неограниченное число переходов
* Многоадресные анонсы
* Интеллектуальное использование VLSM и CIDR
* Поддержка областей и суммирование маршрутов
* Аутентификация маршрутизации
* Передача и маркировка внешних маршрутов

### Терминология

**Канал** - интерфейс на маршрутизаторе

**Сотояние канала** - описание интерфейса и его отношений с соседними маршрутизаторами

* IP адрес
* Маска сети
* Тип сети
* Маршрутизаторы, подключенные к этой сети
* ...

**База данных состояний каналов** - коллекция состояний всех каналов

### Алгоритм при изменении состояния канала

1. Инициализация или изменение маршрутных данных
2. Маршрутизатор генерирует Link State Advertisement (LSA)
3. Маршрутизаторы обмениваются LSA
4. Заполнение базы данных каждого маршрутизатора
5. Маршрутизатор использует алгоритм Дейкстры для вычисления дерева кратчайших путей

### Схема работы OSPF

1. Маршрутизаторы обмениваются hello-пакетами через все интерфейсы, на которых работает OSPF
2. Маршрутизатор переходит в состояние смежности с соседними маршрутизаторами
3. Маршрутизатор посылает объявление о состоянии канала соседям
4. Маршрутизатор, получивший объявление от соседа:
   * Записывает информацию о нем в базу данных
   * Рассылает копию этого объявления всем другим соседям
5. Рассылая объявления через зону, все маршрутизаторы строят идентичную базу данных
6. Когда база данных построена, каждый маршрутизатор использует алгоритм Shortest Path First (SPF) для вычисления графа без петель, который будет описывать кратчайший путь к каждому известному пункту назначения с собой в качестве корня
7. Каждый маршрутизатор строит таблицу маршрутизации, основываясь на своем дереве кратчайшего пути

### Зоны OSPF

Зона (Area) - совокупность сетей и маршрутизаторов, имеющих один и тот же идентификатор зоны.

Разделение на зоны позволяет:

* Снизить нагрузку на ЦПУ маршрутизаторов за счет уменьшения количества перерасчетов про алгоритму SPF
* Уменьшить размер таблиц маршрутизации
* Уменьшить количество пакетов обновлений состояния канала

#### Виды зон

* **Backbone** (магистральная, нулевая)

  Формирует ядро сети OSPF. Все остальные зоны соединены с ней, и межзональная маршрутизация происходит через неё.

  Ответственна за распространение маршрутизирующей информации между зонами.

* **Normal** (стандартная)

  Создаётся по умолчанию. Принимает обновления каналов, суммарные и внешние маршруты.

* **Stab** (тупиковая)

  Не принимает внешние маршруты. Не может иметь ABSR.

* **Totally stubby area** 

  Не принимает суммарные и внешние маршруты. 

* **Not-so-stubby area** (NSSA)

  Не принимает внешние маршруты. Может пробрасывать свои внешние. Допускает ASBR.

* **Totally NSSA**

  Не принимает суммарные и внешние маршруты. Может пробрасывать свои внешние. Допускает ASBR.

#### Типы маршрутизаторов

* Внутренний (internal router)
* Пограничный (area border router, ABR)
* Магистральный (backbone router)
* Пограничный маршрутизатор автономной системы (autonomous system boundary router, ASBR)